<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Event - First Page</title>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

<script type="text/javascript">
 	//var pagePath = "http://green.ust.hk/cgi-bin/news/index.php";
	var  myURL = "";
	var mutuex = true;
	function myFunction(eventID,eventTitle)
		{
		document.getElementById("myEventContent").innerHTML = "";
		var targetURL = "http://green.ust.hk/cgi-bin/news/"+eventID; 
		
		$.get(targetURL, function(data) {
			  var contents = data;
			  document.getElementById("hiddenEventDetails").innerHTML = data; //hidden Event Details
			  var output="";
			  var corecontent = "";
			  var contentLong = "";
			  
			  $('.content').each(function(index, value){
					 	corecontent = $(this).text();
					 	output += corecontent;
						//alert($(this).text());
				});	
				 
			  document.getElementById("myEventContent").innerHTML = "<h3>"+eventTitle.toString()+"</h3><br/>"+output;			  
			});	
		}
	
	$(document).ready(function(){
			
	 		var targetURLIndex = "http://green.ust.hk/cgi-bin/news/index.php";
	 		$.ajax({
	 			beforeSend: function() { //$.mobile.showPageLoadingMsg(); 
	 			}, //Show spinner
				complete: function() { }, //Hide spinner
	 		    url : "http://green.ust.hk/cgi-bin/news/index.php",
	 		    type: "get",
	 		    data : "html",
	 		    success: function(data, textStatus, jqXHR)
	 		    {
	 		        //data - response from server
			 		document.getElementById("myDiv").innerHTML = data;	
					var contents = data;var todaydate = " ";var n = " ";var pageID = "";
					var output = " ";var eventday = " ";var imgID = " ";var imgURL = " ";var imgURL2 = 'images/album-hc.jpg';
					var titleContent = "";var titleContentT = "";var titleContentT1 = "";var titleContentT2 = "";var errimgid = "";
					var targethtml = "";var URLLocal = "";
					//$('.headline').attr('href')
					$('a[href*="news_details"]').each(function(index, value){
				 	//n = $(this).attr();
						 	URLLocal = value.toString();
							todaydate = $('.date').get(index);
							eventday = $(todaydate).text();
							
							pageID = URLLocal.replace("file:///android_asset/www/","");
							imgID = URLLocal.replace("file:///android_asset/www/news_details.php?news_id=","");
							imgURL = 'http://green.ust.hk/~green/cgi-bin/photos/news/'+imgID+'_1.jpg';
							n = "";						
						 	n = $(this).text();	
							titleContent= n.toString();
							titleContentT = titleContent.replace(/[\[\]\s\?\.!-;,:\'\"]+/g,' ');
							titleContentT1  = titleContentT.toString();
							titleContentT2  = titleContentT1.replace("'"," ");
							errimgid = "img"+ index;
							targethtml = '#curevent';
							output += '<li><a href="'+targethtml+'" data-transition="none"'+ "onClick=\"myFunction('"+pageID+"','"+ titleContentT2 +"')\">"+'<img src="'+imgURL+'"'+'class="imgagesize"'+' id="'+errimgid+'" /><h3>'+eventday+'</h3><p>' + n + '</p></a></li>';						
					});				
					//document.getElementById("mainDiv").innerHTML =	imgID;	//debug		
					// $.mobile.hidePageLoadingMsg();
					$('#listview').append(output).listview('refresh');	//update listview
					//$.mobile.hidePageLoadingMsg();			
	 		    },
	 		    error: function (jqXHR, textStatus, errorThrown)
	 		    {   }
	 		});
	}); 
</script>
</head>
<body>
	
		<div data-role="page" id="nav1">
    
        <!-- header -->
        <div data-role="header" data-id="tabnav-header" data-position="fixed" data-theme="b">
            <h1>Event</h1>                 
        </div>
        
        <!-- content -->
        <div data-role="content">
            <div class="content-primary">	
			<ul data-role="listview" id="listview" data-filter="true" data-filter-placeholder="Search events...">
	
			</ul>
			</div><!--/content-primary -->
        </div>
        
        <!-- footer -->
		<div data-role="footer"  data-position="fixed" data-theme="b"> 
        </div><!-- /footer -->
        
    </div> 

	  <!-- page 2 -->
    <div data-role="page" id="curevent">
    
        <!-- header (same data-id for persistent toolbar) -->
        <div data-role="header" data-id="tabnav-header" data-position="fixed" data-theme="b">
        	<a href="index.html" data-icon="back" data-transition="none">Back</a>
        	<h1>Event Details</h1>      	
        </div>
              <!--  style="display:none" -->
        <div id="hiddenEventDetails" style="display:none">
		</div>
        <!-- content -->
        <div data-role="content">
            <div id="myEventContent">					
			</div>				
        </div><!-- /content -->
        
        <!-- footer -->
		<div data-role="footer"  data-position="fixed" data-theme="b">      
        </div><!-- /footer -->
    </div>

</body>
</html>
